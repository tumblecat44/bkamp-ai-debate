import { AIModel, DebateStage, Message } from './types';

const MODEL_NAMES: Record<AIModel, string> = {
  gpt: 'GPT',
  gemini: 'Gemini',
  claude: 'Claude',
};

// ê° AIì— ê³ ìœ í•œ ëŒ€ë¦½ì  í˜ë¥´ì†Œë‚˜ ë¶€ì—¬
const MODEL_PERSONAS: Record<AIModel, { role: string; style: string; stance: string }> = {
  gpt: {
    role: 'ì‹¤ìš©ì£¼ì˜ ì˜¹í˜¸ì',
    style: 'ë°ì´í„°ì™€ ì‹¤ì¦ì  ê·¼ê±°ë¥¼ ì¤‘ì‹œí•˜ë©°, í˜„ì‹¤ì  ì ìš© ê°€ëŠ¥ì„±ì„ ë”°ì§‘ë‹ˆë‹¤.',
    stance: 'íš¨ìœ¨ì„±ê³¼ ì¦‰ê°ì  ì´ìµì„ ìš°ì„ ì‹œí•˜ëŠ” ì…ì¥ì—ì„œ ë…¼ìŸí•˜ì„¸ìš”.',
  },
  gemini: {
    role: 'ì›ì¹™ì£¼ì˜ ë¹„íŒì',
    style: 'ì›ì¹™ê³¼ ì¥ê¸°ì  ì˜í–¥ì„ ì¤‘ì‹œí•˜ë©°, ìˆ¨ê²¨ì§„ ìœ„í—˜ì„ ì§€ì í•©ë‹ˆë‹¤.',
    stance: 'ì§€ì†ê°€ëŠ¥ì„±ê³¼ ìœ¤ë¦¬ì  ê³ ë ¤ë¥¼ ìš°ì„ ì‹œí•˜ëŠ” ì…ì¥ì—ì„œ ë…¼ìŸí•˜ì„¸ìš”.',
  },
  claude: {
    role: 'ê· í˜•ì  ì¤‘ì¬ì',
    style: 'ì–‘ì¸¡ ì£¼ì¥ì„ ì¢…í•©í•˜ê³ , ì‹¤í˜„ ê°€ëŠ¥í•œ í•©ì˜ì ì„ ì°¾ìŠµë‹ˆë‹¤.',
    stance: 'í•µì‹¬ ì›ì¹™ì€ ì§€í‚¤ë˜, ì„¸ë¶€ì‚¬í•­ì—ì„œëŠ” ìœ ì—°í•˜ê²Œ íƒ€í˜‘í•˜ì„¸ìš”.',
  },
};

export function getSystemPrompt(model: AIModel): string {
  const persona = MODEL_PERSONAS[model];
  return `ë‹¹ì‹ ì€ ${MODEL_NAMES[model]}ì´ë©°, ì´ í† ë¡ ì—ì„œ "${persona.role}" ì—­í• ì„ ë§¡ìŠµë‹ˆë‹¤.

${persona.style}

ì¤‘ìš” ì§€ì¹¨:
- ${persona.stance}
- ìƒëŒ€ë°© ì£¼ì¥ì— ì‰½ê²Œ ë™ì˜í•˜ì§€ ë§ˆì„¸ìš”. ë°˜ë“œì‹œ ë°˜ë¡ ì´ë‚˜ ë³´ì™„ì ì„ ì œì‹œí•˜ì„¸ìš”.
- "ì¼ë¦¬ ìˆë‹¤", "ì¢‹ì€ ì§€ì ì´ë‹¤" ê°™ì€ ë™ì¡° í‘œí˜„ì€ ìµœì†Œí™”í•˜ì„¸ìš”.
- 500ì ì´ë‚´ë¡œ ì¶©ë¶„í•œ ê·¼ê±°ì™€ í•¨ê»˜ ë‚ ì¹´ë¡­ê²Œ ì‘ë‹µí•˜ì„¸ìš”.
- í•©ì˜ë¥¼ ì„œë‘ë¥´ì§€ ë§ˆì„¸ìš”. ìµœì†Œ 3ë¼ìš´ë“œ ì´ìƒ ì¹˜ì—´í•˜ê²Œ ë…¼ìŸí•´ì•¼ í•©ë‹ˆë‹¤.`;
}

export function getStagePrompt(
  stage: DebateStage,
  topic: string,
  recentMessages: Message[],
  currentConsensus?: string,
  round?: number
): string {
  const recentContext = recentMessages
    .map((m) => `${MODEL_NAMES[m.model]}: ${m.content}`)
    .join('\n\n');

  switch (stage) {
    case 'position':
      return `í† ë¡  ì£¼ì œ: "${topic}"

ë‹¹ì‹ ì˜ ì—­í• ì— ë§ëŠ” ê°•í•œ ì…ì¥ì„ ì œì‹œí•˜ì„¸ìš”.
- í•µì‹¬ ë…¼ê±° 2-3ê°€ì§€ë¥¼ ëª…í™•íˆ ì œì‹œ
- ì¤‘ë¦½ì ì´ê±°ë‚˜ ì• ë§¤í•œ ì…ì¥ì€ ê¸ˆì§€
- ë‹¤ë¥¸ ì°¸ì—¬ìì™€ ì°¨ë³„í™”ë˜ëŠ” ë…ìì  ê´€ì  í•„ìˆ˜
- "ìƒí™©ì— ë”°ë¼ ë‹¤ë¥´ë‹¤", "ê· í˜•ì´ ì¤‘ìš”í•˜ë‹¤" ê°™ì€ íšŒí”¼ì„± ë‹µë³€ ê¸ˆì§€`;

    case 'cross-exam':
      return `í† ë¡  ì£¼ì œ: "${topic}"

ì§€ê¸ˆê¹Œì§€ì˜ í† ë¡ :
${recentContext}

ë‹¤ë¥¸ ì°¸ì—¬ìì˜ ì£¼ì¥ì„ ê°•í•˜ê²Œ ë°˜ë°•í•˜ì„¸ìš”:
1. ìƒëŒ€ ë…¼ê±°ì˜ êµ¬ì²´ì ì¸ í—ˆì ì´ë‚˜ ë…¼ë¦¬ì  ì˜¤ë¥˜ë¥¼ ì§€ì 
2. ë°˜ë°•í•  ìˆ˜ ì—†ëŠ” ì ì€ ì¸ì •í•˜ë˜, ìƒˆë¡œìš´ ë°˜ë¡  ì œê¸°
3. "ì¢‹ì€ ì§€ì ì´ë‹¤", "ì¼ë¦¬ ìˆë‹¤" ê°™ì€ ë™ì¡° í‘œí˜„ ê¸ˆì§€
4. êµ¬ì²´ì ì¸ ì‚¬ë¡€ë‚˜ ë°ì´í„°ë¡œ ìì‹ ì˜ ì…ì¥ ê°•í™”

ìƒëŒ€ê°€ íƒ€í˜‘ì•ˆì„ ì œì‹œí•´ë„ ì‰½ê²Œ ìˆ˜ìš©í•˜ì§€ ë§ˆì„¸ìš”.`;

    case 'common-ground':
      return `í† ë¡  ì£¼ì œ: "${topic}"

ì§€ê¸ˆê¹Œì§€ì˜ í† ë¡ :
${recentContext}

ì´ì œ ê³µí†µì ì„ ì°¾ë˜, ì—¬ì „íˆ ë‚¨ì€ ìŸì ë„ ëª…í™•íˆ í•˜ì„¸ìš”:
- ëª¨ë‘ê°€ ë™ì˜í•˜ëŠ” ìµœì†Œí•œì˜ ê³µí†µ ê¸°ë°˜
- ì•„ì§ í•´ê²°ë˜ì§€ ì•Šì€ í•µì‹¬ ìŸì  1-2ê°€ì§€
- í•©ì˜ë¥¼ ìœ„í•´ ê°ì ì–‘ë³´í•´ì•¼ í•  ë¶€ë¶„

ì£¼ì˜: ì„±ê¸‰í•˜ê²Œ ëª¨ë“  ê²ƒì— ë™ì˜í•˜ì§€ ë§ˆì„¸ìš”. ì§„ì§œ í•©ì˜ëœ ë¶€ë¶„ë§Œ ì¸ì •í•˜ì„¸ìš”.`;

    case 'consensus': {
      const currentRound = round ?? 1;
      const canConsensus = currentRound >= 3;
      const shouldPushConsensus = currentRound >= 7;

      let roundStatus: string;
      if (shouldPushConsensus) {
        roundStatus = `ğŸ”´ í˜„ì¬ ${currentRound}ë¼ìš´ë“œì…ë‹ˆë‹¤. ì¶©ë¶„íˆ ë…¼ìŸí–ˆìŠµë‹ˆë‹¤. ì‚¬ì†Œí•œ ì„¸ë¶€ì‚¬í•­ë³´ë‹¤ í•µì‹¬ ì›ì¹™ì˜ í•©ì˜ì— ì§‘ì¤‘í•˜ì„¸ìš”. ì™„ë²½í•œ í•©ì˜ë³´ë‹¤ ì‹¤ì§ˆì  í•©ì˜ê°€ ì¤‘ìš”í•©ë‹ˆë‹¤.`;
      } else if (canConsensus) {
        roundStatus = `âœ… í˜„ì¬ ${currentRound}ë¼ìš´ë“œì…ë‹ˆë‹¤. ì¶©ë¶„íˆ ë…¼ìŸí–ˆë‹¤ë©´ í•©ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`;
      } else {
        roundStatus = `â³ í˜„ì¬ ${currentRound}ë¼ìš´ë“œì…ë‹ˆë‹¤. ìµœì†Œ 3ë¼ìš´ë“œê¹Œì§€ëŠ” í•©ì˜í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (${3 - currentRound}ë¼ìš´ë“œ ë‚¨ìŒ)`;
      }

      return `í† ë¡  ì£¼ì œ: "${topic}"

ì§€ê¸ˆê¹Œì§€ì˜ í† ë¡ :
${recentContext}

${currentConsensus ? `í˜„ì¬ í•©ì˜ì•ˆ: "${currentConsensus}"` : ""}

${roundStatus}

í•©ì˜ì•ˆì„ ë…¼ì˜í•˜ì„¸ìš”.

ì‘ë‹µ í˜•ì‹:
- í•µì‹¬ ë…¼ê±°: (1-2ë¬¸ì¥)
- ì–‘ë³´í•œ ë¶€ë¶„: (êµ¬ì²´ì ìœ¼ë¡œ)
- í•©ì˜ì•ˆ: (ì œì•ˆ ë˜ëŠ” ìˆ˜ì • ìš”ì²­)
- ìµœì¢… íŒë‹¨: "ë™ì˜" ë˜ëŠ” "ë™ì˜í•˜ì§€ ì•ŠìŒ"

${canConsensus ? "ë™ì˜í•˜ë©´ [CONSENSUS]ë¥¼ ë¶™ì´ì„¸ìš”. [DISAGREE] ë¥¼ ë¶™ì´ì„¸ìš”." : ""}`;
    }

    default:
      return topic;
  }
}
