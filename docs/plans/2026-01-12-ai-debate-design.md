# AI 끝장 토론 - 설계 문서

## 개요

GPT, Gemini, Claude가 하나의 주제로 토론 후 합의안을 도출하는 웹 애플리케이션.
사용자가 API Key를 직접 입력하여 사용.

## 기술 스택

- **프레임워크**: Next.js (풀스택)
- **UI**: shadcn/ui + Tailwind CSS
- **상태관리**: Zustand
- **AI API**: OpenAI (GPT), Google (Gemini), Anthropic (Claude)

## 페이지 구조

```
/app
├── page.tsx              # 주제 입력 페이지
├── select/page.tsx       # 모델 선택 페이지
├── debate/page.tsx       # 토론 화면
└── api/
    └── chat/route.ts     # AI API 프록시 (스트리밍)
```

## 사용자 플로우

### 페이지 1: 주제 입력
- 심플한 입력창 + "다음" 버튼
- 예시 주제 클릭 시 자동 입력

### 페이지 2: 모델 선택
- 체크박스: GPT / Gemini / Claude (최소 2개 선택)
- "시작하기" 버튼 클릭 → API Key 모달

### API Key 모달
- 선택한 모델별 API Key 입력 필드
- 유효성 검증 없음 (바로 진행)
- "토론 시작" 버튼

### 페이지 3: 토론 화면
- 상단: 토론 주제 + 현재 단계/라운드 + 일시정지 버튼
- 중앙: 채팅 형식 토론 내역 (실시간 스트리밍)
- AI 상태 표시: 발언 완료 / 스트리밍 중 / 대기 중
- 하단: 토큰 사용량 표시

### 결과 화면
- 합의 성공 시: 합의안 + 각 AI별 핵심 논거 + 양보한 부분
- 결렬 시: "합의 실패" + 각 AI 최종 입장
- 버튼: 전체 토론 보기 / 새 토론 / 복사하기

## 토론 구조

### 1단계: 입장 제시 (각 AI 1회)
```
프롬프트: "주제: {topic}. 당신의 입장을 제시하세요."
```

### 2단계: 교차 질문 (2라운드, 총 6턴)
```
프롬프트:
- 최근 5개 대화 기록 포함
- "상대 논거의 약점을 지적하고, 반드시 대안을 제시하세요."
```
- 랜덤 순서로 AI 선택
- 각 AI 2회씩 발언

### 3단계: 공통점 추출 (각 AI 1회)
```
프롬프트: "지금까지 논의를 보고, 모두가 동의하는 공통점을 정리하세요."
```

### 4단계: 합의안 도출 (최대 15라운드)
```
프롬프트:
"공통점 기반 합의안을 제안하거나, 기존 합의안에 동의/수정 요청하세요.
 현재 합의안에 완전히 동의하면 응답 맨 앞에 [CONSENSUS]를 붙이세요."
```

**종료 조건:**
- 한 라운드에서 모든 AI 응답에 `[CONSENSUS]` → 합의 성공
- 15라운드 완료 시 → 결렬

## 대화 기록 관리

- 전체 대화: 프론트엔드(Zustand)에 저장
- API 호출 시: 최근 5개 대화만 포함 (토큰 절약)
- 결과 복사/공유: 저장된 대화 기록 활용

## UI 디자인

### 레이아웃
- 채팅 형식, 전부 왼쪽 정렬
- 색상/아이콘으로 AI 구분

### AI별 색상
- GPT: 초록 (#10A37F)
- Gemini: 파랑 (#4285F4)
- Claude: 주황 (#D97706)

### 라운드 표시
```
[1단계] 입장 제시 2/3
[2단계] 교차 질문 4/6
[3단계] 공통점 추출 1/3
[4단계] 합의안 도출 3/15
```

### AI 상태 표시
```
🟢 GPT: 발언 완료
🔵 Gemini: 스트리밍 중... █
🟠 Claude: 대기 중
```

## 에러 처리

- API 에러 발생 시: 3회 자동 재시도
- 3회 실패 시: 해당 AI "기권" 처리, 나머지로 계속

## 반응형 (모바일)

- AI 상태: 상단 가로 3칸
- 채팅: 세로 스택 (동일)
- 결과 카드: 세로 스택
- 일시정지: 플로팅 버튼

## 추가 기능

- **토론 내역 복사/공유**: 결과 화면에서 복사 버튼
- **다크모드**: 시스템 설정 따라가기
- **토큰 사용량**: 실시간 토큰/비용 카운터

## 프로젝트 구조

```
/app
├── page.tsx              # 주제 입력
├── select/page.tsx       # 모델 선택
├── debate/page.tsx       # 토론 화면
└── api/
    └── chat/route.ts     # AI API 프록시

/components
├── TopicInput.tsx
├── ModelSelector.tsx
├── ApiKeyModal.tsx
├── ChatBubble.tsx
├── DebateStage.tsx
├── AiStatus.tsx
├── ResultSummary.tsx
└── TokenCounter.tsx

/lib
├── debate-engine.ts      # 토론 진행 로직
├── prompts.ts            # 단계별 프롬프트
└── ai-clients.ts         # OpenAI, Gemini, Claude API 래퍼

/store
└── debate-store.ts       # Zustand 스토어
```
